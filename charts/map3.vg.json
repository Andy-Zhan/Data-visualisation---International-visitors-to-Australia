{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "projection": {
    "type": "equirectangular",
    "rotate": [-146, 0, 0]
  },
  "width": "container",
  "height": "container",
  "config": {
    "background": null,
    "view": {
      "stroke": "transparent"
    }
  },

  "data": {
    "url": "../data/short_term_visitors_output.csv",
    "format": { "type": "csv" }
  },
  "params": [
    {
      "name": "Year",
      "value": 2020,
      "bind": { "input": "range", "min": 1991, "max": 2020, "step": 1 }
    }
  ],
  "transform": [
    { "filter": "year(datum.year) === Year" },
    {
      "lookup": "name",
      "from": {
        "data": {
          "url": "../data/world.topojson",
          "format": { "type": "topojson", "feature": "world.geo" }
        },
        "key": "properties.admin"
      },
      "as": "geo"
    },
    {
      "lookup": "name",
      "from": {
        "data": {
          "url": "../data/centroids.csv",
          "format": { "type": "csv" }
        },
        "key": "name",
        "fields": ["lat", "long"]
      }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "../data/world2.topojson",
        "format": { "type": "topojson", "feature": "world.geo" }
      },
      "mark": { "type": "geoshape", "fill": "lightgray", "stroke": "white" },
      "encoding": {
        "color": {
          "value": "#eee"
        },
        "tooltip": [
          { "field": "properties.admin", "type": "nominal", "title": "Name" }
        ]
      }
    },
    {
      "mark": {
        "type": "geoshape",
        "stroke": "black"
      },
      "encoding": {
        "shape": {
          "field": "geo",
          "type": "geojson"
        },
        "color": { "value": "#eee" },
        "tooltip": [
          {
            "field": "geo.properties.admin",
            "type": "nominal",
            "title": "Name"
          },
          { "field": "count", "type": "quantitative", "title": "Visitors" }
        ]
      }
    },
    {
      "mark": { "type": "point", "filled": true, "stroke": "white" },
      "encoding": {
        "longitude": { "field": "long", "type": "quantitative" },
        "latitude": { "field": "lat", "type": "quantitative" },
        "size": {
          "field": "count",
          "type": "quantitative",
          "scale": {
            "rangeMax": 5000,
            "domain": [0, 1438670]
          },
          "sort": {
            "field": "count",
            "order": "descending"
          }
        },
        "color": {
          "field": "count",
          "type": "quantitative",
          "scale": { "domain": [0, 1438670], "scheme": "Oranges" },
          "legend": null
        },
        "opacity": { "value": 0.9 },
        "tooltip": [
          {
            "field": "geo.properties.admin",
            "type": "nominal",
            "title": "Name"
          },
          { "field": "count", "type": "quantitative", "title": "Visitors" }
        ]
      }
    },
    {
      "mark": {
        "type": "rule"
      },
      "encoding": {
        "longitude": {
          "field": "long",
          "type": "quantitative"
        },
        "latitude": {
          "field": "lat",
          "type": "quantitative"
        },
        "longitude2": {
          "field": "long"
        },
        "latitude2": {
          "field": "lat"
        },
        "tooltip": [
          {
            "field": "geo.properties.admin",
            "type": "nominal",
            "title": "Name"
          },
          { "field": "count", "type": "quantitative", "title": "Visitors" }
        ]
      }
    }
  ]
}
